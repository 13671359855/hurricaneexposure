---
title: "Test_case"
author: "Joshua Ferreri"
date: "April 28, 2016"
output: html_document
---

```{r}
# Begin experimenting with major hurricanes (mortality and economic burden)
#Required Libraries
library(lubridate)
library(ggplot2)
library(devtools)
install_github("geanders/hurricaneexposure", 
               build_vignettes = TRUE)
library(hurricaneexposure)
library(weathermetrics)
```

#Example of Max Average Precip: Katrina-2005

```{r}
#Max rain for Katrina
katrina <- rain[rain$storm_id == "Katrina-2005",]
katrina_max <- max(katrina$precip)
k_max_val <- katrina[katrina$precip == katrina_max, ] #maximum for one day
convert_precip(katrina_max, "mm", "inches")
```

##Set up loop to map all hurricanes of interest 

```{r}
#Hurricane tracks and precip for: Katrina, Floyd, Andrew, Ike, Wilma, and Charley
my_hurricanes <- c("Andrew-1992", "Floyd-1999", "Allison-2001", "Charley-2004", 
                   "Katrina-2005", "Wilma-2005", "Ike-2008")
for(hurricane in my_hurricanes){
        hurricane_map <- map_counties(storm = hurricane, 
                                      metric = "rainfall")
        hurricane_track <- map_tracks(storm = hurricane, 
                                      storm_status = TRUE, 
                                      plot_object = hurricane_map)
        print(hurricane_track)
}

#Exposed versus unexposed: Distance 500 km, rain greater or equal to 75 mm over 3 days
for(hurricane in my_hurricanes){
        exposed <- map_rain_exposure(storm = hurricane,
                          rain_limit = 75,
                          dist_limit = 500,
                          days_included = c(-1, 0, 1))
        tracks <- map_tracks(storm = hurricane, 
                             plot_object = exposed)
        print(tracks)
}
```

Rezempour and Baldock (2014), in the development of their tropical cyclone rain index (TCRI), use a reference area parameter ($A_rain0$) where the average rainfall is $geq$ 2mm per hour of rainfall (48mm per day, 144 mm per 3 day window). Using this rainfall reference, the above hurricanes were mapped again with exposure thresholds of 48mm on day 0, and 144 mm for a three day window.

```{r}
#Single day with average of 2 mm per hour (assuming 48 mm total in 24 hours)
for(hurricane in my_hurricanes){
        exposed <- map_rain_exposure(storm = hurricane,
                          rain_limit = 48,
                          dist_limit = 500,
                          days_included = 0)
        tracks <- map_tracks(storm = hurricane, 
                             plot_object = exposed)
        print(tracks)
}
#Three day window assuming 2mm per hour, 48 mm per day, and 144 mm over three days
for(hurricane in my_hurricanes){
        exposed <- map_rain_exposure(storm = hurricane,
                          rain_limit = 144,
                          dist_limit = 500,
                          days_included = c(-1, 0, 1))
        tracks <- map_tracks(storm = hurricane, 
                             plot_object = exposed)
        print(tracks)
}
```
